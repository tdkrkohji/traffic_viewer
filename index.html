<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>äº¬ç‹ç·šãƒ»äº•ã®é ­ç·š åœ¨ç·šçŠ¶æ³ï¼ˆ30ç§’è‡ªå‹•æ›´æ–°ï¼‰</title>
<style>
  body { font-family: "Segoe UI", sans-serif; text-align: center; background: #f8f8f8; margin-bottom: 50px; }
  h1, h2 { margin-top: 30px; }
  table { border-collapse: collapse; margin: 20px auto; width: 90%; max-width: 1000px; background: #fff; }
  th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: center; }
  th { background: #eee; }
  .tokkyu { color: #fff; background: #d32f2f; }     /* ç‰¹æ€¥ â†’ èµ¤ */
  .kyuko { color: #fff; background: #388e3c; }       /* æ€¥è¡Œ â†’ ç·‘ */
  .kaisoku { color: #fff; background: #1976d2; }     /* å¿«é€Ÿ â†’ é’ */
  .kukan { color: #000; background: #fff176; }       /* åŒºé–“æ€¥è¡Œ â†’ é»„è‰² */
  .kakutei { color: #000; background: #e0e0e0; }     /* å„åœ â†’ ç°è‰² */
  #updateTime, #localTime { margin: 5px 0; font-size: 14px; color: #555; }
</style>
</head>
<body>
<h1>äº¬ç‹ç·šãƒ»äº•ã®é ­ç·š åœ¨ç·šçŠ¶æ³</h1>
<p id="updateTime">ãƒ‡ãƒ¼ã‚¿æ›´æ–°ä¸­...</p>
<p id="localTime">ç¾åœ¨æ™‚åˆ»: --:--:--</p>

<h2>ğŸš† äº¬ç‹ç·šãƒ»ç›¸æ¨¡åŸç·š</h2>
<table id="keioTable">
  <tr><th>åˆ—è»Šç•ªå·</th><th>ç¨®åˆ¥</th><th>ä¸Šä¸‹</th><th>ç¾åœ¨ä½ç½®</th><th>è¡Œå…ˆ</th><th>ä¸¡æ•°</th><th>ç•ªç·š</th><th>é…ã‚Œ</th></tr>
</table>

<h2>ğŸš‹ äº•ã®é ­ç·š</h2>
<table id="inokTable">
  <tr><th>åˆ—è»Šç•ªå·</th><th>ç¨®åˆ¥</th><th>ä¸Šä¸‹</th><th>ç¾åœ¨ä½ç½®</th><th>è¡Œå…ˆ</th><th>ä¸¡æ•°</th><th>ç•ªç·š</th><th>é…ã‚Œ</th></tr>
</table>

<script>
const idMap = {
  001:"äº¬ç‹ç·šæ–°å®¿",002:"ç¬¹å¡š",003:"ä»£ç”°æ©‹",004:"æ˜å¤§å‰",005:"ä¸‹é«˜äº•æˆ¸",006:"æ¡œä¸Šæ°´",007:"ä¸ŠåŒ—æ²¢",008:"å…«å¹¡å±±",
  009:"èŠ¦èŠ±å…¬åœ’",010:"åƒæ­³çƒå±±",011:"ä»™å·",012:"ã¤ã¤ã˜ãƒ¶ä¸˜",013:"æŸ´å´",014:"å›½é ˜",015:"å¸ƒç”°",016:"èª¿å¸ƒ",017:"è¥¿èª¿å¸ƒ",
  018:"é£›ç”°çµ¦",019:"æ­¦è”µé‡å°",020:"å¤šç£¨éœŠåœ’",021:"æ±åºœä¸­",022:"åºœä¸­",023:"åˆ†å€æ²³åŸ",024:"ä¸­æ²³åŸ",025:"è–è¹Ÿæ¡œãƒ¶ä¸˜",
  026:"ç™¾è‰åœ’",027:"é«˜å¹¡ä¸å‹•",028:"å—å¹³",029:"å¹³å±±åŸå€å…¬åœ’",030:"é•·æ²¼",031:"åŒ—é‡",032:"äº¬ç‹å…«ç‹å­",
  044:"äº¬ç‹å¤šæ‘©å·",045:"äº¬ç‹ç¨²ç”°å ¤",046:"äº¬ç‹ã‚ˆã¿ã†ã‚Šãƒ©ãƒ³ãƒ‰",047:"ç¨²åŸ",048:"è‹¥è‘‰å°",049:"äº¬ç‹æ°¸å±±",
  050:"äº¬ç‹å¤šæ‘©ã‚»ãƒ³ã‚¿ãƒ¼",051:"äº¬ç‹å €ä¹‹å†…",052:"å—å¤§æ²¢",053:"å¤šæ‘©å¢ƒ",054:"æ©‹æœ¬",
  081:"æ¸‹è°·",082:"ç¥æ³‰",083:"é§’å ´æ±å¤§å‰",084:"æ± ãƒä¸Š",085:"ä¸‹åŒ—æ²¢",086:"æ–°ä»£ç”°",087:"æ±æ¾åŸ",
  088:"æ˜å¤§å‰",089:"æ°¸ç¦ç”º",090:"è¥¿æ°¸ç¦",091:"æµœç”°å±±",092:"é«˜äº•æˆ¸",093:"å¯Œå£«è¦‹ãƒ¶ä¸˜",094:"ä¹…æˆ‘å±±",
  095:"ä¸‰é·¹å°",096:"äº•ã®é ­å…¬åœ’",097:"å‰ç¥¥å¯º"
};

const syMap = {
  1: {name:"ç‰¹æ€¥", class:"tokkyu"},
  2: {name:"æ€¥è¡Œ", class:"kyuko"},
  3: {name:"å¿«é€Ÿ", class:"kaisoku"},
  5: {name:"åŒºé–“æ€¥è¡Œ", class:"kukan"},
  6: {name:"å„åœ", class:"kakutei"},
  9: {name:"ãƒ©ã‚¤ãƒŠãƒ¼", class:"tokkyu"},
  11:{name:"ãƒ©ã‚¤ãƒŠãƒ¼", class:"tokkyu"}
};

function updateLocalTime() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2,"0");
  const m = String(now.getMinutes()).padStart(2,"0");
  const s = String(now.getSeconds()).padStart(2,"0");
  document.getElementById("localTime").textContent = `ç¾åœ¨æ™‚åˆ»: ${h}:${m}:${s}`;
}

async function fetchData() {
  try {
    const res = await fetch("https://i.opentidkeio.jp/data/traffic_info.json?cache=" + Date.now());
    const data = await res.json();

    // --- æ›´æ–°æ™‚åˆ» ---
    const t = data.up?.[0]?.dt?.[0];
    if (t) {
      const hh = String(parseInt(t.hh) % 24).padStart(2,"0");
      document.getElementById("updateTime").textContent =
        `ãƒ‡ãƒ¼ã‚¿æœ€çµ‚æ›´æ–°: ${t.yy}/${t.mt}/${t.dy} ${hh}:${t.mm}:${t.ss}`;
    }

    // ãƒ†ãƒ¼ãƒ–ãƒ«åˆæœŸåŒ–
    const keioTable = document.getElementById("keioTable");
    const inokTable = document.getElementById("inokTable");
    keioTable.innerHTML = `<tr><th>åˆ—è»Šç•ªå·</th><th>ç¨®åˆ¥</th><th>ä¸Šä¸‹</th><th>ç¾åœ¨ä½ç½®</th><th>è¡Œå…ˆ</th><th>ä¸¡æ•°</th><th>ç•ªç·š</th><th>é…ã‚Œ</th></tr>`;
    inokTable.innerHTML = `<tr><th>åˆ—è»Šç•ªå·</th><th>ç¨®åˆ¥</th><th>ä¸Šä¸‹</th><th>ç¾åœ¨ä½ç½®</th><th>è¡Œå…ˆ</th><th>ä¸¡æ•°</th><th>ç•ªç·š</th><th>é…ã‚Œ</th></tr>`;

    function addRows(section, table) {
      section.forEach(st => {
        st.ps.forEach(p => {
          const id = st.id;
          const trNo = p.tr.trim();
          const sy = syMap[p.sy] || {name:"ä¸æ˜", class:""};
          const ik = idMap[p.ik_tr.padStart(3,"0")] || "ä¸æ˜";
          const pos =
            id.startsWith("E") ? idMap[id.slice(1)] + "é§…æ§‹å†…" :
            id.startsWith("U") ? idMap[(+id.slice(1)+1).toString().padStart(3,"0")] + "ã€œ" + idMap[id.slice(1)] + "é–“ ä¸Šã‚Š" :
            id.startsWith("D") ? idMap[id.slice(1)] + "ã€œ" + idMap[(+id.slice(1)-1).toString().padStart(3,"0")] + "é–“ ä¸‹ã‚Š" :
            "ä¸æ˜";
          const updown = parseInt(id.slice(1)) % 2 === 0 ? "ä¸Šã‚Š" : "ä¸‹ã‚Š";
          const delay = p.dl === "00" ? "å¹³å¸¸" : p.dl + "åˆ†é…ã‚Œ";
          const row = `<tr><td>${trNo}</td><td class="${sy.class}">${sy.name}</td><td>${updown}</td><td>${pos}</td><td>${ik}</td><td>${p.sr}</td><td>${p.bs}</td><td>${delay}</td></tr>`;
          table.insertAdjacentHTML("beforeend", row);
        });
      });
    }

    if (data.TS) addRows(data.TS, keioTable);  // äº¬ç‹ç·šãƒ»ç›¸æ¨¡åŸç·š
    if (data.TB) addRows(data.TB, inokTable);  // äº•ã®é ­ç·š
  } catch (e) {
    document.getElementById("updateTime").textContent = "æ›´æ–°å¤±æ•—ï¼š" + e.message;
  }
}

// åˆå›å®Ÿè¡Œ & 30ç§’ã”ã¨è‡ªå‹•æ›´æ–°
fetchData();
setInterval(fetchData, 30000);
setInterval(updateLocalTime, 1000);
updateLocalTime();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja" data-version="v0.1.51">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>é‹è¡Œä¸­åˆ—è»Š â€” v0.1.51</title>
<style>
/* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
:root{
  --bg:#f6f8fa; --panel:#ffffff; --muted:#6e7781; --border:#d0d7de; --accent:#0969da;
  --tokkyu:#FF4C7C; --kyuko:#00B66A; --kaisoku:#0082FF; --kukan:#D8D100; --kakutei:#ced0d4; --liner:#c71585; --linermt:#32cd32;
  --text:#24292e;
}
[data-theme="dark"]{
  --bg:#0d1117; --panel:#0b1117; --muted:#9aa4b2; --border:#30363d; --accent:#58a6ff;
  --tokkyu:#ff6b6b; --kyuko:#7bd389; --kaisoku:#8cc8ff; --kukan:#ffd86b; --kakutei:#5a5f66; --liner:#191970; --linermt:#32cd32;
  --text:#c9d1d9;
}
html,body{height:100%}
body{
  margin:0; font-family:"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,Arial,sans-serif;
  background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;
  line-height:1.45; font-size:13px; padding-bottom:120px;
}
header{padding:14px 12px; text-align:center}
h1{margin:6px 0; font-size:18px}
#meta{font-size:12px;color:var(--muted); display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap}

.tab-bar{display:flex; justify-content:center; gap:8px; padding:8px 12px}
.tab-btn{
  background:var(--panel); border:1px solid var(--border); padding:8px 14px; border-radius:8px;
  cursor:pointer; color:var(--text); font-weight:600;
}
.tab-btn.active{border-color:var(--accent); color:var(--accent);}

.subtabs{display:flex; justify-content:center; gap:8px; margin-top:6px}
.subtab{background:var(--panel); border:1px solid var(--border); padding:6px 10px; border-radius:6px; cursor:pointer}
.subtab.active{border-color:var(--accent); color:var(--accent); font-weight:600}

.container{max-width:1100px; margin:14px auto; padding:0 12px}
.table-wrap{overflow-x:auto; border:1px solid var(--border); border-radius:6px; background:var(--panel); padding:6px; margin-top:8px}
table{width:100%; min-width:760px; border-collapse:collapse; margin:0; background:transparent}
th,td{padding:8px 10px; border:1px solid var(--border); text-align:center; white-space:nowrap}
th{background:transparent; cursor:pointer; font-weight:600}
th.sorted-asc::after{content:" â–²"; font-weight:600}
th.sorted-desc::after{content:" â–¼"; font-weight:600}
tr:hover td{background: rgba(0,0,0,0.03);}

.badge{padding:4px 6px; border-radius:4px; display:inline-block}
.tokkyu{background:var(--tokkyu); color:#fff}
.liner{background:var(--liner); color:#fff}
.linermt{background:var(--linermt); color:#fff}
.kyuko{background:var(--kyuko); color:#fff}
.kaisoku{background:var(--kaisoku); color:#fff}
.kukan{background:var(--kukan); color:#000}
.kakutei{background:var(--kakutei); color:#000}

#alerts{max-width:1100px; margin:14px auto; background:var(--panel); border:1px solid var(--border); border-radius:8px; padding:12px}
.alert-item{padding:8px; border-radius:6px; margin-bottom:8px; font-size:13px}
.alert-delay{background:#ffdfe0; color:#900}
.alert-exchange{background:#fff6d6; color:#8a5b00}

.controls{max-width:1100px; margin:8px auto; display:flex; justify-content:flex-end; gap:8px; align-items:center; padding:0 12px}
select.control, button.control{padding:6px 10px; border-radius:6px; border:1px solid var(--border); background:var(--panel); color:var(--text); cursor:pointer}

footer{margin-top:30px; text-align:center; color:var(--muted); font-size:13px}
</style>
</head>
<body>

<header>
  <h1>é‹è¡Œä¸­åˆ—è»Š <small style="font-size:0.7em;color:var(--muted)">v0.1.51</small></h1>
  
  <div style="margin: 10px 0;">
    <a href="map.html" style="
      display: inline-flex;
      align-items: center;
      padding: 8px 16px;
      background-color: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    ">
      <span style="margin-right: 6px;">ğŸ“</span> ãƒ©ã‚¤ãƒ–é…ç·šå›³ã‚’è¡¨ç¤º
    </a>
  </div>

  <div id="meta">
    <div id="updateTime">ãƒ‡ãƒ¼ã‚¿æ›´æ–°: â€”</div>
    <div id="localTime">ç¾åœ¨æ™‚åˆ»: â€”</div>
  </div>
</header>


<div class="tab-bar">
  <button class="tab-btn active" data-line="keio">äº¬ç‹ç·š</button>
  <button class="tab-btn" data-line="inok">äº•ã®é ­ç·š</button>
</div>

<div class="container">
  <section id="keio" class="line-block">
    <div class="subtabs">
      <button class="subtab active" data-dir="up">ä¸Šã‚Š</button>
      <button class="subtab" data-dir="down">ä¸‹ã‚Š</button>
    </div>
    <div class="table-wrap" id="keio-up-wrap">
      <table id="keio-up">
        <thead>
          <tr><th data-key="sk">é‹ç”¨è¨˜å·</th><th data-key="tr">åˆ—è»Šç•ªå·</th><th data-key="ik">è¡Œå…ˆ</th><th data-key="sy">ç¨®åˆ¥</th><th data-key="sr">ä¸¡æ•°</th><th data-key="pos">ç¾åœ¨ä½ç½®</th><th data-key="bs">ç•ªç·š</th><th data-key="dl">é…ã‚Œ</th><th data-key="remarks">å‚™è€ƒ</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="table-wrap" id="keio-down-wrap" style="display:none;">
      <table id="keio-down">
        <thead>
          <tr><th data-key="sk">é‹ç”¨è¨˜å·</th><th data-key="tr">åˆ—è»Šç•ªå·</th><th data-key="ik">è¡Œå…ˆ</th><th data-key="sy">ç¨®åˆ¥</th><th data-key="sr">ä¸¡æ•°</th><th data-key="pos">ç¾åœ¨ä½ç½®</th><th data-key="bs">ç•ªç·š</th><th data-key="dl">é…ã‚Œ</th><th data-key="remarks">å‚™è€ƒ</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="inok" class="line-block" style="display:none;">
    <div class="subtabs">
      <button class="subtab active" data-dir="up">ä¸Šã‚Š</button>
      <button class="subtab" data-dir="down">ä¸‹ã‚Š</button>
    </div>
    <div class="table-wrap" id="inok-up-wrap">
      <table id="inok-up">
        <thead>
          <tr><th data-key="sk">ä¸Šä¸‹</th><th data-key="tr">åˆ—è»Šç•ªå·</th><th data-key="ik">è¡Œå…ˆ</th><th data-key="sy">ç¨®åˆ¥</th><th data-key="sr">ä¸¡æ•°</th><th data-key="pos">ç¾åœ¨ä½ç½®</th><th data-key="bs">ç•ªç·š</th><th data-key="dl">é…ã‚Œ</th><th data-key="remarks">å‚™è€ƒ</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="table-wrap" id="inok-down-wrap" style="display:none;">
      <table id="inok-down">
        <thead>
          <tr><th data-key="sk">ä¸Šä¸‹</th><th data-key="tr">åˆ—è»Šç•ªå·</th><th data-key="ik">è¡Œå…ˆ</th><th data-key="sy">ç¨®åˆ¥</th><th data-key="sr">ä¸¡æ•°</th><th data-key="pos">ç¾åœ¨ä½ç½®</th><th data-key="bs">ç•ªç·š</th><th data-key="dl">é…ã‚Œ</th><th data-key="remarks">å‚™è€ƒ</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</div>

<div id="alerts">
  <h3>é€šçŸ¥</h3>
  <div id="alertsInner">ç‰¹è¨˜äº‹é …ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
</div>

<div class="controls">
  <select id="intervalSelect" class="control">
    <option value="10000">10ç§’</option>
    <option value="30000" selected>30ç§’</option>
    <option value="60000">1åˆ†</option>
  </select>
  <button id="themeBtn" class="control">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼šåˆ‡æ›¿</button>
</div>

<footer>v0.1.51</footer>

<script>
window.onerror = (m, s, l) => console.error(`Error: ${m} at ${l}`);

const FEED_URL = "https://i.opentidkeio.jp/data/traffic_info.json";

const idMap = {
  "001":"äº¬ç‹ç·šæ–°å®¿","002":"ç¬¹å¡š","003":"ä»£ç”°æ©‹","004":"æ˜å¤§å‰","005":"ä¸‹é«˜äº•æˆ¸","006":"æ¡œä¸Šæ°´","007":"ä¸ŠåŒ—æ²¢",
  "008":"å…«å¹¡å±±","009":"èŠ¦èŠ±å…¬åœ’","010":"åƒæ­³çƒå±±","011":"ä»™å·","012":"ã¤ã¤ã˜ãƒ¶ä¸˜","013":"æŸ´å´","014":"å›½é ˜",
  "015":"å¸ƒç”°","016":"èª¿å¸ƒ","017":"è¥¿èª¿å¸ƒ","018":"é£›ç”°çµ¦","019":"æ­¦è”µé‡å°","020":"å¤šç£¨éœŠåœ’","021":"æ±åºœä¸­",
  "022":"åºœä¸­","023":"åˆ†å€æ²³åŸ","024":"ä¸­æ²³åŸ","025":"è–è¹Ÿæ¡œãƒ¶ä¸˜","026":"ç™¾è‰åœ’","027":"é«˜å¹¡ä¸å‹•","028":"å—å¹³",
  "029":"å¹³å±±åŸå€å…¬åœ’","030":"é•·æ²¼","031":"åŒ—é‡","032":"äº¬ç‹å…«ç‹å­","033":"æ–°ç·šæ–°å®¿","034":"åˆå°","035":"å¹¡ãƒ¶è°·",
  "036":"åºœä¸­ç«¶é¦¬æ­£é–€å‰","037":"å¤šæ‘©å‹•ç‰©å…¬åœ’","038":"äº¬ç‹ç‰‡å€‰","039":"å±±ç”°","040":"ã‚ã˜ã‚å°","041":"ç‹­é–“",
  "042":"é«˜å°¾","043":"é«˜å°¾å±±å£","044":"äº¬ç‹å¤šæ‘©å·","045":"äº¬ç‹ç¨²ç”°å ¤","046":"äº¬ç‹ã‚ˆã¿ã†ã‚Šãƒ©ãƒ³ãƒ‰","047":"ç¨²åŸ",
  "048":"è‹¥è‘‰å°","049":"äº¬ç‹æ°¸å±±","050":"äº¬ç‹å¤šæ‘©ã‚»ãƒ³ã‚¿ãƒ¼","051":"äº¬ç‹å €ä¹‹å†…","052":"å—å¤§æ²¢","053":"å¤šæ‘©å¢ƒ",
  "054":"æ©‹æœ¬","081":"æ¸‹è°·","082":"ç¥æ³‰","083":"é§’å ´æ±å¤§å‰","084":"æ± ãƒä¸Š","085":"ä¸‹åŒ—æ²¢","086":"æ–°ä»£ç”°",
  "087":"æ±æ¾åŸ","088":"æ˜å¤§å‰","089":"æ°¸ç¦ç”º","090":"è¥¿æ°¸ç¦","091":"æµœç”°å±±","092":"é«˜äº•æˆ¸","093":"å¯Œå£«è¦‹ãƒ¶ä¸˜",
  "094":"ä¹…æˆ‘å±±","095":"ä¸‰é·¹å°","096":"äº•ã®é ­å…¬åœ’","097":"å‰ç¥¥å¯º","100":"æ–°ç·šæ–°å®¿",
  "101":"æ–°å®¿ä¸‰ä¸ç›®","102":"æ›™æ©‹","103":"å¸‚ãƒ¶è°·","104":"ä¹æ®µä¸‹","105":"ç¥ä¿ç”º","106":"å°å·ç”º","107":"å²©æœ¬ç”º",
  "108":"é¦¬å–°æ¨ªå±±","109":"æµœç”º","110":"æ£®ä¸‹","111":"èŠå·","112":"ä½å‰","113":"è¥¿å¤§å³¶","114":"å¤§å³¶",
  "115":"æ±å¤§å³¶","116":"èˆ¹å €","117":"ä¸€ä¹‹æ±Ÿ","118":"ç‘æ±Ÿ","119":"ç¯ å´","120":"æœ¬å…«å¹¡",
  "300":"äº¬ç‹ç·šæ–°å®¿ãƒ»éƒ½å–¶æ–°å®¿ç·šæ–¹é¢","301":"éƒ½å–¶æ–°å®¿ç·šæ–¹é¢","302":"äº¬ç‹ç·šæ–°å®¿æ–¹é¢","303":"èª¿å¸ƒæ–¹é¢",
  "304":"é«˜å¹¡ä¸å‹•æ–¹é¢","305":"å…«å¹¡å±±æ–¹é¢","306":"ç¬¹å¡šæ–¹é¢","400":"äº¬ç‹å…«ç‹å­æ–¹é¢","401":"é«˜å°¾å±±å£æ–¹é¢",
  "402":"æ©‹æœ¬æ–¹é¢","403":"åºœä¸­ãƒ»åºœä¸­ç«¶é¦¬æ­£é–€å‰æ–¹é¢","501":"æ˜å¤§å‰ãƒ»æ°¸ç¦ç”ºæ–¹é¢","502":"å‰ç¥¥å¯ºæ–¹é¢"
};

const syMap = {
  1:{name:"ç‰¹æ€¥", cls:"tokkyu"}, 2:{name:"æ€¥è¡Œ", cls:"kyuko"}, 3:{name:"å¿«é€Ÿ", cls:"kaisoku"},
  5:{name:"åŒºé–“æ€¥è¡Œ", cls:"kukan"}, 6:{name:"å„åœ", cls:"kakutei"}, 9:{name:"ãƒ©ã‚¤ãƒŠãƒ¼", cls:"liner"},
  11:{name:"ãƒ©ã‚¤ãƒŠãƒ¼", cls:"linermt"}
};

const to3 = (n) => String(n).padStart(3, '0');

function updownFromTrain(tr, stId) {
  const num = parseInt(tr.replace(/\D/g, ""), 10);
  if (!isNaN(num)) return (num % 2 === 0) ? "up" : "down";
  return "up";
}

function skToLabel(sk) {
  const m = { "8":"8000", "9":"9000", "5":"5000", "2":"2000", "7":"7000", "0":"10-300" };
  return m[String(sk)] || "";
}

function classifyLineByIk(ik_tr) {
  const n = parseInt(ik_tr);
  return (n >= 81 && n <= 97) ? "inok" : "keio";
}

function posLabel(stId) {
  const special = {
    "S016":"äº¬ç‹å¤šæ‘©å·ã€œèª¿å¸ƒé–“ ä¸Šã‚Š", "S031":"äº¬ç‹ç‰‡å€‰ã€œåŒ—é‡é–“ ä¸Šã‚Š", "D038":"åŒ—é‡ã€œäº¬ç‹ç‰‡å€‰é–“ ä¸‹ã‚Š",
    "S021":"æ±åºœä¸­ã€œåºœä¸­ç«¶é¦¬æ­£é–€å‰é–“ ä¸‹ã‚Š", "S027":"å¤šæ‘©å‹•ç‰©å…¬åœ’ã€œé«˜å¹¡ä¸å‹•é–“ ä¸Šã‚Š",
    "D037":"é«˜å¹¡ä¸å‹•ã€œå¤šæ‘©å‹•ç‰©å…¬åœ’é–“ ä¸‹ã‚Š", "D044":"èª¿å¸ƒã€œäº¬ç‹å¤šæ‘©å·é–“ ä¸‹ã‚Š",
    "S002":"å¹¡ãƒ¶è°·ã€œç¬¹å¡šé–“ ä¸‹ã‚Š", "U035":"ç¬¹å¡šã€œå¹¡ãƒ¶è°·é–“ ä¸Šã‚Š"
  };
  if (special[stId]) return special[stId];
  if (!stId || stId.length < 2) return "ä¸æ˜";
  const kind = stId[0], n = parseInt(stId.slice(1), 10);
  if (kind === "E") return idMap[to3(n)] || `#${n}`;
  if (kind === "U") return `${idMap[to3(n + 1)] || n+1}ã€œ${idMap[to3(n)] || n}é–“ ä¸Šã‚Š`;
  if (kind === "D") return `${idMap[to3(n)] || n}ã€œ${idMap[to3(n - 1)] || n-1}é–“ ä¸‹ã‚Š`;
  return "ä¸æ˜";
}

/* --- é€šçŸ¥ç®¡ç† --- */
const NOTIF_KEY = "traffic_viewer_notifications_v1";
function loadNotifs(){ try{ return JSON.parse(localStorage.getItem(NOTIF_KEY)) || {expires:0,list:[]}; }catch(e){ return {expires:0,list:[]}; } }
function addNotifUnique(type, text) {
  const obj = loadNotifs();
  if (!obj.list.some(x => x.text === text)) {
    obj.list.push({ type, text, time: new Date().toLocaleTimeString("ja-JP", { hour12: false }) });
    obj.expires = new Date().setHours(25, 15, 0, 0); 
    localStorage.setItem(NOTIF_KEY, JSON.stringify(obj));
  }
}

/* --- ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ --- */
function bindSortable(table) {
  if (!table || table._bound) return;
  table.tHead.querySelectorAll("th").forEach((th, idx) => {
    th.addEventListener("click", () => {
      const asc = !th.classList.contains("sorted-asc");
      table.tHead.querySelectorAll("th").forEach(h => h.classList.remove("sorted-asc", "sorted-desc"));
      th.classList.add(asc ? "sorted-asc" : "sorted-desc");
      const rows = Array.from(table.tBodies[0].rows);
      
      rows.sort((a, b) => {
        // ç¾åœ¨ä½ç½®(index: 5)ã®å ´åˆã¯ã€é§…ID(dataset.trainId)ã§é§…é †ã‚½ãƒ¼ãƒˆ
        if (idx === 5) {
          const idA = a.dataset.trainId || "";
          const idB = b.dataset.trainId || "";
          return asc ? idA.localeCompare(idB) : idB.localeCompare(idA);
        }
        const A = a.cells[idx].innerText, B = b.cells[idx].innerText;
        return asc ? A.localeCompare(B, "ja", { numeric: true }) : B.localeCompare(A, "ja", { numeric: true });
      });
      rows.forEach(r => table.tBodies[0].appendChild(r));
    });
  });
  table._bound = true;
}

async function fetchAndRender() {
  try {
    let toeiMap = {};
    try {
      const tRes = await fetch("toei.txt");
      if (tRes.ok) {
        const tText = await tRes.text();
        let currentUnyo = "";
        tText.split("\n").forEach(line => {
          line = line.trim();
          if (/^\d+[A-Z]$/.test(line)) currentUnyo = line;
          else if (line) line.split(",").forEach(tr => toeiMap[tr.trim()] = currentUnyo);
        });
      }
    } catch(e) {}

    const res = await fetch(FEED_URL + "?cache=" + Date.now());
    const data = await res.json();
    
    const t = data.up?.[0]?.dt?.[0];
    if(t) document.getElementById("updateTime").textContent = `ãƒ‡ãƒ¼ã‚¿æ›´æ–°: ${t.yy}/${t.mt}/${t.dy} ${t.hh}:${t.mm}:${t.ss}`;

    const bodies = { "keio-up": document.querySelector("#keio-up tbody"), "keio-down": document.querySelector("#keio-down tbody"), "inok-up": document.querySelector("#inok-up tbody"), "inok-down": document.querySelector("#inok-down tbody") };
    Object.values(bodies).forEach(b => b.innerHTML = "");

    const trainCount = {};
    [...(data.TS || []), ...(data.TB || [])].forEach(st => (st.ps || []).forEach(p => { if(p.tr) trainCount[p.tr] = (trainCount[p.tr] || 0) + 1; }));

    [...(data.TS || []), ...(data.TB || [])].forEach(st => {
      (st.ps || []).forEach(p => {
        const trNo = (p.tr || "").trim();
        if (!trNo) return;

        const line = classifyLineByIk(p.ik_tr);
        const dir = updownFromTrain(trNo, st.id);
        const targetBody = bodies[`${line}-${dir}`];
        if (!targetBody) return;

        const sy = syMap[p.sy] || { name: "ä¸æ˜", cls: "" };
        const ikLabel = idMap[to3(p.ik_tr)] || `ä¸æ˜(${p.ik_tr})`;
        const dlNum = parseInt(p.dl, 10) || 0;
        
        let remarks = [];
        if (sy.name === "ç‰¹æ€¥" && p.sr === "8") remarks.push("ç‰¹æ€¥(8ä¸¡)");
        if (trainCount[trNo] > 1) { remarks.push("è»Šä¸¡äº¤æ›äºˆå®š"); addNotifUnique("exchange", `${trNo}:è»Šä¸¡äº¤æ›äºˆå®š`); }
        if (parseInt(p.ik_tr) >= 101 && parseInt(p.ik_tr) <= 120) remarks.push("éƒ½å–¶ç›´é€š");
        if (dlNum >= 15) addNotifUnique("delay", `${trNo}: ${dlNum}åˆ†é…ã‚Œ`);

        const unyoLabel = toeiMap[trNo] ? `<span style="color:#00a;font-weight:bold;margin-right:4px;">${toeiMap[trNo]}</span>` : "";

        const row = document.createElement("tr");
        // st.id (ä¾‹: E001, D016ãªã©) ã‚’ã‚½ãƒ¼ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒ
        row.dataset.trainId = st.id || ""; 
        
        row.innerHTML = `
          <td>${skToLabel(p.sk) || "-"}</td>
          <td>${unyoLabel}${trNo}</td>
          <td>${ikLabel}</td>
          <td><span class="badge ${sy.cls}">${sy.name}</span></td>
          <td>${p.sr || ""}</td>
          <td>${posLabel(st.id)}</td>
          <td>${p.bs || ""}</td>
          <td>${dlNum === 0 ? "å¹³å¸¸" : dlNum + "åˆ†é…ã‚Œ"}</td>
          <td>${remarks.join("ãƒ»")}</td>
        `;
        targetBody.appendChild(row);
      });
    });

    const alertsOut = document.getElementById("alertsInner");
    const obj = loadNotifs();
    if (obj.list.length) {
      alertsOut.innerHTML = "";
      obj.list.forEach(it => {
        const d = document.createElement("div");
        d.className = `alert-item ${it.type === "delay" ? "alert-delay" : "alert-exchange"}`;
        d.textContent = `${it.text} [${it.time}]`;
        alertsOut.appendChild(d);
      });
    }
    Object.keys(bodies).forEach(id => bindSortable(document.getElementById(id)));

  } catch (err) { console.error(err); }
}

document.addEventListener("DOMContentLoaded", () => {
  // è·¯ç·šã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
  document.querySelectorAll(".tab-btn").forEach(btn => btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".line-block").forEach(lb => lb.style.display = "none");
    document.getElementById(btn.dataset.line).style.display = "block";
  }));
  // ä¸Šä¸‹ã‚µãƒ–ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
  document.querySelectorAll(".subtab").forEach(s => s.addEventListener("click", (e) => {
    const block = e.target.closest(".line-block");
    block.querySelectorAll(".subtab").forEach(x => x.classList.remove("active"));
    s.classList.add("active");
    block.querySelectorAll(".table-wrap").forEach(w => w.style.display = "none");
    block.querySelector(`#${block.id}-${s.dataset.dir}-wrap`).style.display = "block";
  }));
  // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰
  document.getElementById("themeBtn").addEventListener("click", () => {
    document.documentElement.hasAttribute("data-theme") ? document.documentElement.removeAttribute("data-theme") : document.documentElement.setAttribute("data-theme", "dark");
  });
  
  fetchAndRender();
  // æ›´æ–°é–“éš”ã®åæ˜ 
  let intervalId = setInterval(fetchAndRender, 30000);
  document.getElementById("intervalSelect").addEventListener("change", (e) => {
    clearInterval(intervalId);
    intervalId = setInterval(fetchAndRender, parseInt(e.target.value));
  });

  setInterval(() => { document.getElementById("localTime").textContent = "ç¾åœ¨æ™‚åˆ»: " + new Date().toLocaleTimeString("ja-JP"); }, 1000);
});
</script>
</body>
</html>

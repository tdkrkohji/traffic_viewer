<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>ライブ配線図 (CSS描画版)</title>
    <style>
        :root {
            --bg: #0d1117;
            --line: #ffffff;
            --station-bg: rgba(255, 255, 255, 0.1);
            --accent: #58a6ff;
        }
        body {
            margin: 0; background: var(--bg); color: #fff;
            font-family: sans-serif; overflow-x: hidden;
        }
        header {
            padding: 10px; background: rgba(0,0,0,0.5);
            display: flex; align-items: center; border-bottom: 1px solid #333;
        }
        /* 線路を描画するエリア */
        .railway-map {
            position: relative;
            width: 100%;
            height: 400px; /* 必要に応じて調整 */
            margin-top: 20px;
            background: #000;
            overflow-x: auto;
            border-top: 1px solid #333; border-bottom: 1px solid #333;
        }
        .canvas {
            position: relative;
            width: 1200px; /* 描画の基準幅 */
            height: 100%;
        }
        /* 線路（CSSで引く） */
        .track {
            position: absolute;
            height: 2px; background: var(--line);
            width: 100%;
        }
        .station-box {
            position: absolute;
            background: var(--station-bg);
            border: 1px solid #555;
            color: #ccc; font-size: 10px;
            display: flex; align-items: center; justify-content: center;
        }

        /* 列車アイコン */
        .train {
            position: absolute;
            width: 20px; height: 14px;
            background: #f06; border-radius: 2px;
            border: 1px solid #fff;
            transform: translate(-50%, -50%);
            z-index: 100; transition: all 1s ease;
        }
        .train-label {
            position: absolute; top: -18px; left: 50%;
            transform: translateX(-50%);
            font-size: 10px; background: #000; padding: 1px 3px;
        }

        /* 各駅・線路の具体的な位置設定 */
        /* 例: 本線 */
        .track.honsen-up { top: 150px; left: 0; width: 100%; }
        .track.honsen-down { top: 180px; left: 0; width: 100%; }
        /* 例: 新線 */
        .track.shinsen-up { top: 100px; left: 0; width: 300px; }
        
        /* 駅ラベル */
        .st-name { position: absolute; font-size: 12px; color: #aaa; }
    </style>
</head>
<body>

<header>
    <a href="index.html" style="color:var(--accent); text-decoration:none; margin-right:15px;">← 戻る</a>
    <h1 style="font-size:16px; margin:0;">京王線 配線図モニター</h1>
</header>

<div class="railway-map">
    <div class="canvas" id="mapCanvas">
        <div class="track honsen-up"></div>
        <div class="track honsen-down"></div>
        
        <div class="st-name" style="top:130px; left:50px;">新宿</div>
        <div class="station-box" style="top:145px; left:40px; width:60px; height:12px;">1・2番線</div>
        
        <div class="st-name" style="top:130px; left:300px;">笹塚</div>
        
        </div>
</div>

<script>
// 座標を「ピクセル」ではなく「画面に対する％」や「独自グリッド」で管理可能
const posMap = {
    "E001_1": { x: 70, y: 151 },
    "E001_2": { x: 70, y: 181 },
    "E002":   { x: 300, y: 151 },
    // いただいた座標を、このCSSのスケールに合わせて変換して登録
};

async function update() {
    const res = await fetch("https://i.opentidkeio.jp/data/traffic_info.json?" + Date.now());
    const data = await res.json();
    const canvas = document.getElementById('mapCanvas');
    
    document.querySelectorAll('.train').forEach(e => e.remove());

    [...(data.TS || []), ...(data.TB || [])].forEach(st => {
        (st.ps || []).forEach(p => {
            const key = p.bs ? `${st.id}_${p.bs}` : st.id;
            const pos = posMap[key];
            if(pos) {
                const tr = document.createElement('div');
                tr.className = 'train';
                tr.style.left = pos.x + "px";
                tr.style.top = pos.y + "px";
                tr.innerHTML = `<div class="train-label">${p.tr}</div>`;
                canvas.appendChild(tr);
            }
        });
    });
}
setInterval(update, 30000);
update();
</script>
</body>
</html>
